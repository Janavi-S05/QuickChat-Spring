<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.1/stomp.min.js"></script>
</head>
<body>
	<div class="container mt-4">
		<h1 class="text-center">Real-Time Chat Application</h1>
		<div id="chat" 
		     class="border rounded p-3 mb-3"
		     style="height:300px; overflow-y: auto;">
		</div>
		
		<div class="input-group mb-3">
			<input id="senderInput" type="text" class="form-control"
				   placeholder="Your name....."/>
		</div>
		
		<div class="input-group mb-3">
			<input id="messageInput" type="text" class="form-control"
				   placeholder="Type a message....."/>
		    <div id="input-group-append">
		    	<button id="sendMessage" class="btn btn-primary">Send</button>
		    </div>
		</div>
	</div>
</body>

<script>

var stompClient = null;

function connect() {
    var socket = new SockJS('/chat'); // create webSocket connection using SockJS and connects to spring boot webSocket endpoint
    stompClient = Stomp.over(socket); // wraps the connection to send/receive formal messages
    
    // Browser is now connected to the server(springboot application)
    stompClient.connect({}, function(frame) {
        setConnected(true); // client to server msg transfer
        // server to client communication
        stompClient.subscribe('/topic/messages', function(message)  { // this function(message) is executed only runs when server pushes a message
            showMessage(JSON.parse(message.body));
        });
    });
}

function setConnected(connected) {
    document.getElementById('sendMessage').disabled = !connected;
}

function showMessage(message) {
    var chat = document.getElementById('chat');
    var messageElement = document.createElement('div');
    messageElement.textContent = message.sender + ' : ' + message.content;
    messageElement.className = "border-bottom mb-1";
    chat.appendChild(messageElement);
    chat.scrollTop = chat.scrollHeight;
}

function sendMessage() {
    var sender = document.getElementById('senderInput').value;
    var content = document.getElementById('messageInput').value;

    var chatMessage = {
        sender: sender,
        content: content
    };

    stompClient.send("/app/sendMessage", {}, JSON.stringify(chatMessage));
    document.getElementById('messageInput').value = '';
}

document.getElementById('sendMessage').onclick = sendMessage;
window.onload = connect; // when user opens the chat page connect() func runs

</script>

</html>